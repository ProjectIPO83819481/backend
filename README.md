# ТЕХНИЧЕСКОЕ ЗАДАНИЕ

## Проект 41: Система бытовых услуг

## 1. ОБЩИЕ СВЕДЕНИЯ

### 1.1. Наименование проекта
Платформа для заказа и управления услугами по дому и ремонту "CustomerServices"

### 1.2. Назначение системы
Разработка веб-платформы для автоматизации процесса заказа бытовых услуг (уборка, сантехника, электрика, ремонт) с возможностью выбора исполнителей, управления заказами и контроля качества выполненных работ.

### 1.3. Целевая аудитория
- **Клиенты:** физические лица, нуждающиеся в бытовых услугах
- **Исполнители:** специалисты в области уборки, сантехники, электрики и ремонта
- **Администраторы:** сотрудники платформы для модерации и поддержки

### 1.5. Технологический стек

#### 1.5.1. Backend
- **Язык программирования:** Python 3.11+
- **Web-фреймворк:** FastAPI 0.104+
- **ORM:** SQLAlchemy 2.0+
- **Миграции БД:** Alembic
- **Валидация данных:** Pydantic 2.0+
- **Асинхронность:** asyncio, asyncpg

#### 1.5.2. База данных
- **Основная БД:** PostgreSQL 15+

#### 1.5.3. Дополнительные технологии
- **API документация:** Swagger/OpenAPI (встроенная в FastAPI)

---

## 2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 2.1. Каталог услуг

#### 2.1.1. Категории услуг
Система должна поддерживать следующие категории:
- Уборка (стандартная, генеральная, после ремонта, мытье окон)
- Сантехника (установка, ремонт, профилактика, аварийные работы)
- Электрика (монтаж, ремонт, замена проводки, установка оборудования)
- Ремонт (косметический, капитальный, отделочные работы)

#### 2.1.2. Описание услуги
Каждая услуга должна содержать:
- Название услуги
- Детальное описание
- Базовая цена или диапазон цен
- Средняя продолжительность выполнения
- Необходимые материалы (если применимо)
- Фотографии примеров работ

#### 2.1.3. Требования к каталогу
- Возможность фильтрации по категориям
- Поиск услуг по ключевым словам
- Сортировка по цене, популярности, рейтингу

### 2.2. Профили исполнителей

#### 2.2.1. Информация в профиле
- ФИО исполнителя
- Фотография
- Специализация (одна или несколько категорий)
- Опыт работы (в годах)
- Рейтинг (от 1 до 5 звезд)
- Количество выполненных заказов
- График работы
- Зона обслуживания (район/город)

#### 2.2.2. Требования к исполнителям
- Исполнитель может иметь несколько специализаций
- Обязательное указание минимум одной специализации
- Возможность редактирования профиля
- Невозможность удаления профиля при наличии активных заказов

### 2.3. Система заказов

#### 2.3.1. Создание заказа
Клиент должен указать:

- Конкретную услугу из каталога
- Адрес выполнения работ
- Предпочтительную дату
- Предпочтительное время
- Детальное описание проблемы/задачи
- Прикрепление фотографий (опционально)

#### 2.3.2. Расчет стоимости
Система должна рассчитывать стоимость на основе:
- Базовой цены услуги
- Сложности работ (определяется исполнителем)
- Предполагаемого времени выполнения
- Стоимости материалов (если требуются)
- Срочности заказа (коэффициент за срочность)

**Формула расчета:**
```
Стоимость = Базовая_цена + (Время_работы × Тариф_час) + Материалы + Коэффициент_срочности
```

#### 2.3.3. Подбор исполнителя
- Автоматическое предложение исполнителей с соответствующей специализацией
- Отображение доступных исполнителей в выбранной зоне
- Возможность выбора конкретного исполнителя клиентом
- Уведомление исполнителей о новом заказе

#### 2.3.4. Статусы заказа
Система должна поддерживать следующие статусы:

| Статус | Описание |
|--------|----------|
| Новый | Заказ создан, ожидает принятия исполнителем |
| Принят | Исполнитель подтвердил заказ |
| В работе | Исполнитель приступил к выполнению |
| Завершен | Работы выполнены, ожидается подтверждение клиента |
| Отменен | Заказ отменен клиентом или исполнителем |

#### 2.3.5. Переходы между статусами


### 2.4. Отзывы и рейтинги

#### 2.4.1. Требования к отзывам
- Отзыв может быть оставлен только после завершения заказа
- Оценка от 1 до 5 звезд (обязательно)
- Текстовый комментарий (опционально, до 1000 символов)
- Запрет на публикацию отзыва до завершения заказа

#### 2.4.2. Расчет рейтинга исполнителя
```
Рейтинг = Сумма_всех_оценок / Количество_отзывов
```

#### 2.4.3. Отображение отзывов
- Все отзывы публичны
- Сортировка по дате (новые первыми)
- Фильтрация по оценке
- Ответ исполнителя на отзыв (опционально)


---

## 3. БИЗНЕС-ПРАВИЛА И ОГРАНИЧЕНИЯ

### 3.1. Разрешенные операции

#### 3.1.1. Управление услугами
- Создание, редактирование, удаление услуг администратором
- Временное отключение услуги (без удаления)
- Изменение цен и описаний

#### 3.1.2. Управление исполнителями
- Регистрация новых исполнителей
- Редактирование профиля
- Добавление/удаление специализаций
- Временная блокировка (suspension)

#### 3.1.3. Управление заказами
- Создание заказа клиентом
- Принятие заказа исполнителем
- Изменение статуса заказа
- Отмена заказа (с ограничениями)

### 3.2. Запрещенные операции

#### 3.2.1. Ценообразование
**Запрещено:** Отрицательная стоимость услуги
- Валидация: `стоимость > 0`
- Минимальная стоимость: 100 рублей
- Проверка на этапе создания заказа и расчета

#### 3.2.2. Назначение исполнителей
**Запрещено:** Назначение заказа исполнителю без соответствующей специализации
- Проверка наличия специализации перед назначением
- Валидация: `специализация_исполнителя ∈ категория_заказа`

Пример:
```
Заказ: "Замена крана" (категория: Сантехника)
Исполнитель А: специализации = [Электрика]         → ЗАПРЕЩЕНО
Исполнитель Б: специализации = [Сантехника]        → РАЗРЕШЕНО
Исполнитель В: специализации = [Сантехника, Уборка] → РАЗРЕШЕНО
```

#### 3.2.3. Отзывы и рейтинги
**Запрещено:** Публикация отзыва до завершения заказа
- Проверка статуса заказа перед публикацией
- Валидация: `статус_заказа === "Завершен"`
- Период для оставления отзыва: 30 дней после завершения

#### 3.2.4. Изменение стоимости
**Запрещено:** Изменение стоимости после подтверждения заказа без согласования
- Исключение: доплата за дополнительные работы
- Процесс согласования:
  1. Исполнитель создает запрос на изменение стоимости
  2. Указывает причину и новую сумму
  3. Клиент получает уведомление
  4. Клиент подтверждает или отклоняет
  5. При подтверждении — стоимость обновляется
  6. При отклонении — стоимость остается прежней

#### 3.2.5. Удаление исполнителей
**Запрещено:** Удаление исполнителя с активными заказами
- Проверка перед удалением: `количество_активных_заказов === 0`
- Активные заказы: статусы "Новый", "Принят", "В работе"
- Возможность: временная блокировка вместо удаления

### 3.3. Граничные случаи

#### 3.3.1. Отмена заказа исполнителем
**Сценарий:** Исполнитель не может выполнить принятый заказ

**Процесс:**
1. Исполнитель отменяет заказ с указанием причины
2. Система фиксирует отмену в истории исполнителя
3. Влияние на рейтинг: -0.1 звезды за каждую отмену
4. **Автоматическое предложение альтернатив:**
   - Система находит других исполнителей с той же специализацией
   - Отправляет уведомления топ-5 исполнителям по рейтингу
   - Клиент получает список доступных альтернатив
   - Клиент выбирает нового исполнителя или отменяет заказ

**Ограничения:**
- Более 3 отмен в месяц — временная блокировка аккаунта

#### 3.3.2. Обнаружение дополнительных работ
**Сценарий:** В процессе выполнения обнаружены проблемы, требующие дополнительных работ

**Процесс:**
1. Исполнитель переводит заказ в статус "Ожидание согласования"
2. Создает запрос на дополнительные работы:
   - Описание обнаруженной проблемы
   - Фотографии (опционально)
   - Список дополнительных работ
   - Стоимость дополнительных работ
   - Время выполнения
3. Клиент принимает решение:
   - **Согласен:** доплата добавляется к заказу, работы продолжаются
   - **Не согласен:** работы завершаются в изначальном объеме
4. При согласии обновляется:
   - Общая стоимость заказа
   - Описание работ
   - История изменений

**Требования:**
- Клиент должен ответить в течение 1 часа
- При отсутствии ответа — работы выполняются в изначальном объеме
